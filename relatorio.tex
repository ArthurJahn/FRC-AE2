
\documentclass[a4paper]{report} %padrao letterpaper, 10pt
\usepackage[utf8]{inputenc}
\usepackage[brazil]{babel}
\usepackage{amsfonts,amssymb,graphicx,enumerate}
\usepackage[centertags]{amsmath}
% Configuracoes de pagina
\usepackage[lmargin=3cm,rmargin=3cm,tmargin=3cm,bmargin=3cm]{geometry}
% Layout da pagina
\usepackage{hyperref}
% Layout para código
\usepackage{listings}
% Font for code style
\usepackage{courier}
% The 68 standard colors known to dvips
\usepackage[usenames,dvipsnames]{xcolor}
\hypersetup{pdfpagelayout=SinglePage, % ou TwoPageLeft
    colorlinks=true,
    pdftitle={Relatório de asuhaush Redes},
    pdfauthor={Áulus Diniz, Arthur Jahn}}

%*******************************************************
\definecolor{light-gray}{gray}{0.90}
\lstset{
  backgroundcolor=\color{light-gray},
  basicstyle=\footnotesize\ttfamily
}

\title{Fundamentos de Redes de Computadores: \\ Camada de Transporte}
\author{Arthur Jahn, Áulus Diniz}
\date{26 de Outubro de 2015}    %para ocultar a data digite: \date{ }
%*******************************************************
\begin{document}    %Inicio do documento
\maketitle  %cria o titulo na capa

\tableofcontents %Sumario
%-------------------------------------------------------
\chapter{Protocolos de Camada de Aplicação}
\label{chap_primeiro} %rotulo que pode ser usado em referencia cruzada

\section{Monitoramento e Coleta de Pacotes}
\label{sec_primeiro_monitoramento}

	Para	se capturar os pacotes recebidos e enviados pela rede, foi utilizada a ferramenta \textit{tshark}, uma versão para terminal de comandos que possui todas as opções da ferramenta de interface gráfica \textit{WireShark}, ambas ferramentas de monitoramento e diagnóstico de redes.

	Nos experimentos efetuados para este trabalho, foi utilizada uma distribuição Linux Debian versão 7.9 e para tal, os seguintes passos foram necessários para instalação e configuração do ambiente de experimentação e documentação.
\begin{lstlisting}[language=bash]

	sudo aptitude install tshark

	sudo aptitude install texlive

	sudo aptitude install texlive-lang-portuguese


\end{lstlisting}

	Para que fosse possível analisar os pacotes específicos de cada protocolo da camada de aplicação, foi necessário analisar o tipo de pacote que deveria ser capturado segundo os protocolos de transporte utilizados. No caso de pacotes transmitidos pelo protocolo DNS da camada de aplicação, é necessário capturar apenas pacotes que utilizem na camada de transporte protocolo UDP e que possuam 53 como número de porta de destino. Já para capturar pacotes HTTP, é necessário restringir os pacotes para aqueles que utilizem na camada inferior, protocolo TCP e que tenham 80 como número de porta de destino. O protocolo FTP
também utiliza protocolo TCP para transporte, mas tem como porta de destino o número 21.

	Nesse sentido, e utilizando as opções disponíveis para captura de pacotes da aplicação de diagnóstico \textit{tshark}, foram definidos os comandos necessários para se filtrar os pacotes capturados para cada um dos protocolos da camada de aplicação descritos acima, foram estes respectivamente:
\begin{lstlisting}[language=bash]

	tshark udp port 53

	tshark tcp port 80

	tshark tcp port 21

\end{lstlisting}

	Além dos comandos necessários para captura de pacotes, tem de se especificar um arquivo para direcionar a saída do comando executado, resultando nos seguintes comandos finais utilizados:
\begin{lstlisting}[language=bash]

	tshark udp port 53 > outputDNS.txt

	tshark tcp port 80 > outputHTTP.txt

	tshark tcp port 21 > outputFTP.txt

\end{lstlisting}

\section{Protocolo DNS}
\label{sec_dns}
		O DNS provê serviços de resolução de \textit{hosts} por meio da tradução de nomes de domínios em números de endereçamento IP. Como um mesmo domínio pode estar vinculado a vários endereços IP, esse serviço pode ser responsável também por distribuição de carga entre os \textit{hosts} de destino, alternando o endereço fornecido ao cliente quando uma solicitação de resolução de domínio é feita. Uma consulta DNS consiste basicamente de uma requisição enviada pelo cliente seguida de uma resposta devolvida pelo servidor. Nesse sentido, é interessante a utilização de um protocolo de transporte sem estabelecimento de conexão como o UDP para não acarretar em um atraso na requisição, como no caso do protocolo TCP que necessita de um \textit{handshake} de três vias.

		O serviço de DNS utiliza normalmente a porta 53, sendo esta observada na captura dos pacotes coletados.
\subsection{Dados coletados e Análise}
\label{sub_dns_dados}

Após a execução do comando de captura de pacotes especificado na seção anterior, foi aberto um novo terminal para teste de captura com o comando wget apontando para o nome de domínio do site tcpdump:
\begin{lstlisting}[language=bash]

	wget http://tcpdump.org/

\end{lstlisting}

	No arquivo de captura obteve-se os seguintes pacotes registrados:

\begin{lstlisting}[language=bash]

	0.000000    10.0.2.15 -> 201.10.1.4   DNS 75 Standard query 0x1e44
  A www.tcpdump.org
	0.000124    10.0.2.15 -> 201.10.1.4   DNS 75 Standard query 0xde66
  AAAA www.tcpdump.org
	0.350827   201.10.1.4 -> 10.0.2.15    DNS 131 Standard query response 0xde66
  AAAA 2001:4830:116e:2::6 AAAA 2607:f0b0:c:200::66
	0.356026   201.10.1.4 -> 10.0.2.15    DNS 107 Standard query response 0x1e44
  A 132.213.238.6 A 192.139.46.66

\end{lstlisting}

	Os pacotes enviados do cliente (IP 10.0.2.15) foram enviados ao \textit{host} de destino com IP 201.10.1.4 que respondeu às solicitações. É importante ressaltar que foram enviadas duas requisições do cliente, e as respostas do servidor DNS continham um identificador IPv6 no primeiro pacote recebido e um IPv4 no segundo. Como especificado na RFC 1886, que descreve sobre a adição de IPv6 com o registro AAAA em consultas DNS \cite{IETF}.

\section{Protocolo HTTP}
\label{sec_http}
O protocolo HTTP utilizado na camada de aplicação está vinculado à requsuição e ao carregamento de páginas \textit{web}, estas necessitam de tranferência confiável de dados para que nenhuma parte da informação presente na página seja perdida na rede. Nesse sentido, o protocolo HTTP utiliza na camada de transporte o protocolo TCP que disponibiliza em seus serviços transmissão confiável de dados. Esta é uma das características que tornam o TCP mais viável como protocolo de transporte para o HTTP na internet. 

	Tendo como base o protocolo TCP, é necessário que ocorra então um \textit{handshake} em três vias para que mensagens HTTP possam transitar na rede. Além disso, menagens HTTP devem especificar a operação a ser executada (como GET, POST, PUT, etc) e a porta de destino utilizada que geralmente é a porta 80. 
\subsection{Dados coletados e Análise}
\label{sub_http_dados}

	Após a execução do comando de captura de pacotes especificado na seção anterior, foi aberto um novo terminal para teste de captura com o comando wget apontando para o nome de domínio do site tcpdump, agora escutando por pacotes tcp na porta 80:

\begin{lstlisting}[language=bash]
	
	wget http://tcpdump.org/ 
	
\end{lstlisting}

	No arquivo de captura, dentre vários pacotes de tranferência de dados, foram selecionados alguns para demonstrar as operações executadas. São eles:
	
\begin{lstlisting}[language=bash]
	72.660377    10.0.2.15 -> 173.194.42.51 TCP 74 60075 > http 
  [SYN] 	Seq=0 Win=14600 Len=0 MSS=1460 SACK_PERM=1 TSval=4846684 TSecr=0 WS=64
	72.814395 173.194.42.51 -> 10.0.2.15    TCP 60 http > 60075 
  [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460
	72.814427    10.0.2.15 -> 173.194.42.51 TCP 54 60075 > http 
  [ACK] Seq=1 Ack=1 Win=14600 Len=0
	72.814984    10.0.2.15 -> 173.194.42.51 HTTP 168 GET / HTTP/1.1 
	72.815162 173.194.42.51 -> 10.0.2.15    TCP 60 http > 60075 
  [ACK] Seq=1 Ack=115 Win=65535 Len=0
	72.982628 173.194.42.51 -> 10.0.2.15    HTTP 550 HTTP/1.1 302 Found  (text/html)
	
     		. . . [finishing connection with host 173.194.42.51]
	
	73.141034    10.0.2.15 -> 173.194.42.56 TCP 74 46241 > http 
  [SYN] Seq=0 Win=14600 Len=0 MSS=1460 SACK_PERM=1 TSval=4846804 TSecr=0 WS=64
	73.301732 173.194.42.56 -> 10.0.2.15    TCP 60 http > 46241 
  [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=1460
     73.301836    10.0.2.15 -> 173.194.42.56 TCP 54 46241 > http 
  [ACK] Seq=1 Ack=1 Win=14600 Len=0
     
     		. . . [data transfer with host 173.194.42.56]
     					 					
	73.700321 173.194.42.56 -> 10.0.2.15    HTTP 487 HTTP/1.1 200 OK  (text/html)
	73.700456    10.0.2.15 -> 173.194.42.56 TCP 54 46241 > http 
  [ACK] Seq=154 Ack=20286 Win=41122 Len=0     					
	73.701066    10.0.2.15 -> 173.194.42.56 TCP 54 46241 > http 
  [FIN, ACK] Seq=154 Ack=20286 Win=41122 Len=0
	73.701286 173.194.42.56 -> 10.0.2.15    TCP 60 http > 46241
  [ACK] Seq=20286 Ack=155 Win=65535 Len=0
	73.868597 173.194.42.56 -> 10.0.2.15    TCP 60 http > 46241 
  [FIN, ACK] Seq=20286 Ack=155 Win=65535 Len=0
	73.868618    10.0.2.15 -> 173.194.42.56 TCP 54 46241 > http 
  [ACK] Seq=155 Ack=20287 Win=41122 Len=0  					
  
     
\end{lstlisting}
	
	O primeiro bloco de pacotes mostrado é um \textit{handshake} em três vias do cliente IP 10.0.2.15 com o servidor IP 173.194.42.51, após o \textit{handshake}, o servidor notifica o cliente que encontrou a página requerida e o redireciona para outro servidor que poderá fornecer o pedido, com a flag HTTP 302. Esse comportamento pode indicar que o \textit{host} com IP 173.194.42.51 atua como um \textit{firewall} da rede. 
	
	O segundo bloco de pacotes mostra novamente um \textit{handshake} em três vias do cliente IP 10.0.2.15, mas com o servidor IP 173.194.42.56 desta vez, e logo após se inicia a troca de mensagens para o recebimento da página requerida. Após a transferência, o servidor indica que a requisição está ok (HTTP 200), o cliente envia um ACK e após isso ocorre a finalização da conexão TCP, nos quatro últimos pacotes.

	O log completo de saída da captura de pacotes pode ser visualizado no apêndice A.

\section{Protocolo FTP}
\label{sec_ftp}
	
	O protocolo FTP é utilizado para tranferências de arquivos e, para isso, necessita de tranferência confiável de dados pela internet. Sendo assim, também faz uso do protocolo TCP para transporte de mensagens. 
	
	Desse modo, é esperado para o FTP que ocorra um \textit{handshake} em três vias para estabelecimento de conexão com o servidor. Após o \textit{handshake}, ocorre a autenticação do usuário para que então ocorra o recebimento do arquivo. 
	
\subsection{Dados coletados e Análise}
\label{sub_ftp_dados}
	Os passos descritos ateriormente podem ser observados nos pacotes recebidos na porta 21 monitorada quando se solicita um arquivo com o comando:
	
\begin{lstlisting}[language=bash]
	
	wget ftp://sppedtest.tele2.net/1KB.zip 
	
	
\end{lstlisting}
	
	Os pacotes recebidos no arquivo de saída são:
	
\begin{lstlisting}[language=bash]

     0.000000    10.0.2.15 -> 90.130.70.73 TCP 74 40899 > ftp [SYN] 
  Seq=0 Win=14600 Len=0 MSS=1460 SACK_PERM=1 TSval=8682778 TSecr=0 WS=64
     0.328906 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [SYN, ACK] 
  Seq=0 Ack=1 Win=65535 Len=0 MSS=1460
     0.328945    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [ACK] 
  Seq=1 Ack=1 Win=14600 Len=0
     0.632970 90.130.70.73 -> 10.0.2.15    FTP 74 Response: 220 (vsFTPd 2.3.5)
     0.633001    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [ACK] Seq=1 Ack=21 
  Win=14600 Len=0
     0.633211    10.0.2.15 -> 90.130.70.73 FTP 70 Request: USER anonymous
     0.633472 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=21 Ack=17 
  Win=65535 Len=0 
     0.942161 90.130.70.73 -> 10.0.2.15    FTP 88 Response: 331 Please specify 
  the password.
     0.942293    10.0.2.15 -> 90.130.70.73 FTP 67 Request: PASS -wget@
     0.942528 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=55 Ack=30 
  Win=65535 Len=0
     1.276685 90.130.70.73 -> 10.0.2.15    FTP 77 Response: 230 Login successful.
     1.276878    10.0.2.15 -> 90.130.70.73 FTP 60 Request: SYST
     1.276996 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=78 Ack=36  
  Win=65535 Len=0
     1.557551 90.130.70.73 -> 10.0.2.15    FTP 73 Response: 215 UNIX Type: L8
     1.557694    10.0.2.15 -> 90.130.70.73 FTP 59 Request: PWD
     1.557827 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=97 Ack=41 
  Win=65535 Len=0
     1.867867 90.130.70.73 -> 10.0.2.15    FTP 63 Response: 257 "/"
     1.868044    10.0.2.15 -> 90.130.70.73 FTP 62 Request: TYPE I
     1.868320 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=106 Ack=49 
  Win=65535 Len=0
     2.171201 90.130.70.73 -> 10.0.2.15    FTP 85 Response: 200 Switching to Binary mode.
     2.171366    10.0.2.15 -> 90.130.70.73 FTP 68 Request: SIZE 1KB.zip
     2.171679 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=137 Ack=63 
  Win=65535 Len=0
     2.475659 90.130.70.73 -> 10.0.2.15    FTP 64 Response: 213 1024
     2.475784    10.0.2.15 -> 90.130.70.73 FTP 60 Request: PASV
     2.475938 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=147 Ack=69 
  Win=65535 Len=0
     2.884872 90.130.70.73 -> 10.0.2.15    FTP 105 Response: 227 Entering 
     Passive Mode (90,130,70,73,102,109)
     2.922799    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [ACK] Seq=69 Ack=197 
  Win=14600 Len=0
     3.198408    10.0.2.15 -> 90.130.70.73 FTP 68 Request: RETR 1KB.zip
     3.198535 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=197 Ack=83 
  Win=65535 Len=0
     3.490530 90.130.70.73 -> 10.0.2.15    FTP 121 Response: 150 
     Opening BINARY mode data connection for 1KB.zip (1024 bytes).
     3.490549    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [ACK] Seq=83 Ack=264 
  Win=14600 Len=0
     3.797609 90.130.70.73 -> 10.0.2.15    FTP 78 Response: 226 Transfer complete.
     3.797631    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [ACK] Seq=83 Ack=288 
  Win=14600 Len=0
     3.797766    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [FIN, ACK] Seq=83 Ack=288 
  Win=14600 Len=0
     3.797889 90.130.70.73 -> 10.0.2.15    TCP 60 ftp > 40899 [ACK] Seq=288 Ack=84 
  Win=65535 Len=0
     4.119880 90.130.70.73 -> 10.0.2.15    FTP 94 Response: 500 OOPS: 
  vsf_sysutil_recv_peek: no data
     4.119911    10.0.2.15 -> 90.130.70.73 TCP 54 40899 > ftp [RST] Seq=84 Win=0 Len=0
	
\end{lstlisting}	

	Os pacotes recebidos evidenciam o \textit{handshake} entre o cliente IP 10.0.2.15 com o servidor IP 90.130.70.73 e é importante ressaltar que houve o processo de autorização (mesmo que de um usuário anônimo) para que a transferência ocorrece. Além disso, é possível observar também que o protocolo FTP não criptografa informações de usuário e senha, o que o torna pouco utilizado sem mecanismos de criptografia, como um protocolo ssl ou um ftp sob ssh. 

%-------------------------------------------------------
\chapter{Ferramentas de Diagnóstico de Redes}
\label{chap_segundo}

\section{Monitoramento e Coleta de Pacotes}
\label{sec_segundo_monitoramento}

Aqui deve vir o processo de preparação para o monitoramento e captura de pacotes para as ferramentas de
diagnóstico de redes. Sendo estas:
\begin{enumerate}[a)]
 \item Traceroute;
 \item Ping;
 \item Nmap;
\end{enumerate}

\section{Traceroute}
\label{sec_traceroute}
Aqui vai algo sobre o traceroute.
\subsection{Dados coletados}
\label{sub_traceroute_dados}
Aqui vão os dados coletados para a ferramenta traceroute.

\subsection{Análise}
\label{sub_traceroute_analise}
Aqui vai a análise dos dados coletados para a ferramenta traceroute.

\section{Ping}
\label{sec_ping}
Aqui vai algo sobre o ping.
\subsection{Dados coletados}
\label{sub_ping_dados}
Aqui vão os dados coletados para a ferramenta ping.

\subsection{Análise}
\label{sub_ping_analise}
Aqui vai a análise dos dados coletados para a ferramenta ping.

\section{Nmap}
\label{sec_nmap}
Aqui vai algo sobre o nmap.
\subsection{Dados coletados}
\label{sub_nmap_dados}
Aqui vão os dados coletados para a ferramenta nmap.

\subsection{Análise}
\label{sub_nmap_analise}
Aqui vai a análise dos dados coletados para a ferramenta nmap.

% Referencias bibliograficas
\begin{thebibliography}{99}
\bibitem{Stewart} STEWART, James. {\sl C\'alculo.} Vol. 1. S\~ao Paulo: Pioneira, 2006.
\bibitem{IETF} IETF, Internet Engineering Task Force, RFC 1886, \url{http://tools.ietf.org/html/rfc1886}, 1995.

\bibitem{LaTeX}
\url{http://latexbr.blogspot.com}
\end{thebibliography}

\addcontentsline{toc}{chapter}{Refer\^encias Bibliogr\'aficas}

\end{document}  %Fim do documento
